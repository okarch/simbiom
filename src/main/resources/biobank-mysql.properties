db.url=jdbc:mysql://localhost/biobank?autoReconnect=true
db.driver=com.mysql.jdbc.Driver
db.username=biobank
db.password=biobank
db.retryCount=10
db.schema=biobank
db.test=select 1 from dual
db.pooled=true

db.content.server=localhost:7272

biobank.studysample.table=t_sample_studymember
biobank.studysample.structure=( sampleid varchar(36)\, studyid bigint\, trackid bigint )
biobank.studysample.index=( sampleid )
biobank.studysample.index=( studyid )
biobank.studysample.index=( trackid )
biobank.studysample.insert=insert into ${biobank.studysample.table} values( ?\, ?\, ? )
biobank.studysample.duplicate=select * from ${biobank.studysample.table} where sampleid = ? and studyid = ?

biobank.accession.table=t_sample_accession
biobank.accession.structure=( sampleid varchar(36)\, accession varchar(50)\, acctype varchar(30)\, orgid bigint\, trackid bigint )
biobank.accession.index=( sampleid )
biobank.accession.index=( accession )
biobank.accession.index=( acctype )
biobank.accession.index=( orgid )
biobank.accession.index=( trackid )
biobank.accession.findAccession=select a.* from ${biobank.accession.table} a\, ${biobank.studysample.table} s where a.accession = ? and a.orgid = ? and a.sampleid = s.sampleid and s.studyid = ?
biobank.accession.findAccessionAll=select a.* from ${biobank.accession.table} a where a.accession = ? and a.orgid = ?
biobank.accession.findSampleAccession=select a.* from ${biobank.accession.table} a where a.sampleid = ?
biobank.accession.insert=insert into ${biobank.accession.table} values( ?\, ?\, ?\, ?\, ? )

biobank.billing.table=t_storage_billing
biobank.billing.structure=( billid bigint primary key\, projectid bigint\, purchase varchar(30)\, projectcode varchar(50)\, currency varchar(3)\, total float )
biobank.billing.index=( projectid )
biobank.billing.index=( purchase )
biobank.billing.index=( projectcode )
biobank.billing.insert=insert into ${biobank.billing.table} values( ?\, ?\, ?\, ?\, ?\, ? )
biobank.billing.update=update ${biobank.billing.table} set projectid = ?\, purchase = ?\, projectcode = ?\, currency = ?\, total = ? where billid = ?
biobank.billing.findById=select b.* from ${biobank.billing.table} b where b.billid = ?
biobank.billing.findByPurchase=select b.* from ${biobank.billing.table} b where b.purchase = ?
biobank.billing.findByPurchaseProject=select b.* from ${biobank.billing.table} b where b.purchase = ? and b.projectid = ?
biobank.billing.findByProject=select b.* from ${biobank.billing.table} b where b.projectid = ?
biobank.billing.findAll=select b.* from ${biobank.billing.table} b

biobank.column.table=t_property_column
biobank.column.structure=( columnid bigint primary key\, propertyid bigint\, dbformat varchar(50)\, informat varchar(254)\, outformat varchar(254)\, columnsize int\, digits int\, minoccurs int\, maxoccurs int\, mandatory varchar(5) )
biobank.column.index=( propertyid )
biobank.column.insert=insert into ${biobank.column.table} values( ?\, ?\, ?\, ?\, ?\, ?\, ?\, ?\, ?\, ? )
biobank.column.delete=delete from ${biobank.column.table} where propertyid = ?
biobank.column.findById=select * from ${biobank.column.table} where typeid = ?

biobank.cost.table=t_storage_cost
biobank.cost.structure=( costid bigint primary key\, region varchar(10)\, servicegroup varchar(80)\, serviceitem varchar(100)\, unit varchar(30)\, frequency varchar(20)\, price float\, currency varchar(3) )
biobank.cost.index=( region )
biobank.cost.index=( servicegroup )
biobank.cost.index=( serviceitem )
biobank.cost.findById=select * from ${biobank.cost.table} where costid = ?

biobank.costsample.table=t_storage_cost_preference
biobank.costsample.structure=( preferenceid bigint primary key\, typename varchar(80)\, region varchar(10)\, rank int\, costtype varchar(20)\, costid bigint )
biobank.costsample.index=( typename )
biobank.costsample.index=( region )
biobank.costsample.index=( rank )
biobank.costsample.index=( costtype )
biobank.costsample.index=( costid )
biobank.costsample.findByCost=select p.*\,c.region\,c.servicegroup\,c.serviceitem\,c.unit\,c.frequency\,c.price\,c.currency from ${biobank.costsample.table} p\, ${biobank.cost.table} c where p.costid = c.costid and p.costid = ?
biobank.costsample.findByType=select p.*\,c.region\,c.servicegroup\,c.serviceitem\,c.unit\,c.frequency\,c.price\,c.currency from ${biobank.costsample.table} p\, ${biobank.cost.table} c where p.costid = c.costid and p.typename = ? and p.region = ? order by p.rank
biobank.costsample.findAllTypes=select p.* from ${biobank.costsample.table} p where p.costtype = 'sample' group by p.typename

biobank.country.table=t_country
biobank.country.findByName=select c.* from ${biobank.country.table} c where lower(c.name) like ?
biobank.country.findById=select * from ${biobank.country.table} where id = ?

biobank.group.table=t_storage_group
biobank.group.structure=( groupid bigint primary key\, projectid bigint\, groupname varchar(128)\, groupref varchar(50) )
biobank.group.index=( projectid )
biobank.group.index=( groupname )
biobank.group.insert=insert into ${biobank.group.table} values( ?\, ?\, ?\, ? )
biobank.group.update=update ${biobank.group.table} set projectid = ?\, groupname = ?\ where groupid = ?
biobank.group.deleteAll=delete from ${biobank.group.table} where projectid = ?

biobank.item.table=t_storage_cost_item
biobank.item.structure=( costitemid bigint primary key\, estimateid bigint\, itemtype varchar(80)\, costid bigint\, itemcount bigint )
biobank.item.index=( estimateid )
biobank.item.index=( itemtype )
biobank.item.index=( costid )
biobank.item.delete=delete from ${biobank.item.table} where estimateid = ?
biobank.item.insert=insert into ${biobank.item.table} values( ?\, ?\, ?\, ?\, ? )

biobank.estimate.table=t_storage_costestimate
biobank.estimate.structure=( estimateid bigint primary key\, projectname varchar(80)\, region varchar(10)\, created timestamp\, duration int\, total float )
biobank.estimate.index=( projectname )
biobank.estimate.findById=select e.*\,i.costitemid\,i.itemtype\,i.costid\,i.itemcount from ${biobank.estimate.table} e left join ${biobank.item.table} i on (e.estimateid = i.estimateid) where e.estimateid = ?
biobank.estimate.insert=insert into ${biobank.estimate.table} values( ?\, ?\, ?\, ?\, ?\, ? )
biobank.estimate.update=update ${biobank.estimate.table} set projectname = ?\, region = ?\, created = ?\, duration = ?\, total = ? where estimateid = ?
biobank.item.expired=delete from ${biobank.item.table} where estimateid in (select estimateid from ${biobank.estimate.table} where created < ?)
biobank.estimate.expired=delete from ${biobank.estimate.table} where created < ?

biobank.donor.table=t_sample_donor
biobank.donor.structure=( sampleid varchar(36)\, donorid bigint\, trackid bigint )
biobank.donor.index=( sampleid )
biobank.donor.index=( donorid )
biobank.donor.index=( trackid )
biobank.donor.insert=insert into ${biobank.donor.table} values( ?\, ?\, ? )
biobank.donor.findBySample=select * from ${biobank.donor.table} where sampleid = ?
biobank.donor.duplicate=select * from ${biobank.donor.table} where sampleid = ? and donorid = ?

biobank.donorproperty.table=t_donor_property
biobank.donorproperty.structure=( donorid bigint, propertyid bigint )
biobank.donorproperty.index=( donorid )
biobank.donorproperty.index=( propertyid )
biobank.donorproperty.insert=insert into ${biobank.donorproperty.table} values( ?\, ? )

biobank.event.table=t_sample_time
biobank.event.structure=( timeid bigint primary key\, orgid bigint\, visit varchar(50)\, cycle varchar(10)\, day int\, hour float\, dosage varchar(50)\, quantity float\, unit varchar(10) )
biobank.event.index=( orgid )
biobank.event.index=( processed )
biobank.event.index=( visit )
biobank.event.insert=insert into ${biobank.event.table} values( ?\, ?\, ?\, ?\, ?\, ?\, ?\, ?\, ? )
biobank.event.findBySite=select * from ${biobank.event.table} where orgid = ? and visit = ?
biobank.event.findById=select * from ${biobank.event.table} where timeid = ?

biobank.log.table=t_inventory_log
biobank.log.structure=( logid bigint primary key\, uploadid bigint\, logstamp timestamp\, level varchar(10)\, line bigint\, message varchar(254) )
biobank.log.index=( uploadid )
biobank.log.index=( logstamp )
biobank.log.index=( level )
biobank.log.index=( line )
biobank.log.insert=insert into ${biobank.log.table} values( ?\, ?\, ?\, ?\, ?\, ? )
biobank.log.deleteAll=delete from ${biobank.log.table} where uploadid = (select u.uploadid from ${biobank.upload.table} u where u.templateid = ?)
biobank.log.findByUpload=select * from ${biobank.log.table} where uploadid = ? order by line;

biobank.member.table=t_property_member
biobank.member.structure=( listid bigint\, propertyid bigint\, rank int\, display varchar(5) )
biobank.member.index=( listid )
biobank.member.index=( propertyid )
biobank.member.index=( rank )
biobank.member.delete=delete from ${biobank.member.table} where listid = ?
biobank.member.insert=insert into ${biobank.member.table} values( ?\, ?\, ?\, ? )
biobank.member.property=select * from ${biobank.member.table} where propertyid = ?

biobank.organization.table=t_sample_organization
biobank.organization.structure=( orgid bigint primary key\, orgname varchar(50)\, siteid varchar(20)\, countryid smallint(5) unsigned\, orgtype varchar(50) )
biobank.organization.index=( orgname )
biobank.organization.index=( siteid )
biobank.organization.index=( countryid )
biobank.organization.index=( orgtype )
biobank.organization.findById=select * from ${biobank.organization.table} where orgid = ?
biobank.organization.findByName=select * from ${biobank.organization.table} where orgname = ?
biobank.organization.insert=insert into ${biobank.organization.table} values( ?\, ?\, ?\, ?\, ? )
biobank.organization.update=update ${biobank.organization.table} set orgname = ?\, siteid = ?\, countryid = ?\, orgtype = ? where orgid = ?
biobank.organization.findCollectionSite=select o.* from t_sample_time t\, t_sample_processing p\, t_sample_organization o where p.treatid = 5 and t.timeid = p.timeid and o.orgid = t.orgid and p.sampleid = ?

biobank.process.table=t_sample_processing
biobank.process.structure=( sampleid varchar(36)\, treatid bigint\, timeid bigint\, step int\, processed timestamp\, trackid bigint )
biobank.process.index=( sampleid )
biobank.process.index=( treatid )
biobank.process.index=( timeid )
biobank.process.index=( processed )
biobank.process.index=( trackid )
biobank.process.findByEvent=select * from ${biobank.process.table} where sampleid = ? and treatid = ? and timeid = ?
biobank.process.findByVisit=select p.*\,t.visit from ${biobank.process.table} p\, ${biobank.event.table} t where p.sampleid = ? and p.treatid = ? and p.timeid = t.timeid order by p.processed
biobank.process.insert=insert into ${biobank.process.table} values( ?\, ?\, ?\, ?\, ?\, ? )
biobank.process.update=update ${biobank.process.table} set step = ?\, processed = ?\, trackid = ? where sampleid = ? and treatid = ? and timeid = ?

biobank.project.table=t_storage_project
biobank.project.structure=( projectid bigint primary key\, title varchar(128)\, created timestamp )
biobank.project.index=( title )
biobank.project.index=( created )
biobank.project.insert=insert into ${biobank.project.table} values( ?\, ?\, ? )
biobank.project.update=update ${biobank.project.table} set title = ?\, created = ? where projectid = ?
biobank.project.findByTitle=select p.*\, g.groupid\, g.groupname\, g.groupref from ${biobank.project.table} p left join ${biobank.group.table} g on (p.projectid = g.projectid) where lower(p.title) like ? order by p.projectid
biobank.project.findById=select p.*\, g.groupid\, g.groupname\, g.groupref from ${biobank.project.table} p left join ${biobank.group.table} g on (p.projectid = g.projectid) where p.projectid = ?

biobank.invoice.table=t_storage_invoice
biobank.invoice.structure=( invoiceid bigint primary key\, purchase varchar(30)\, invoice varchar(30)\, started timestamp\, ended timestamp\, verified timestamp\, approved timestamp\, currency varchar(3)\, numsamples float\, amount float\, rejected timestamp\, reason varchar(250)\, created timestamp )
biobank.invoice.index=( purchase )
biobank.invoice.index=( invoice )
biobank.invoice.index=( started )
biobank.invoice.index=( ended )
biobank.invoice.index=( numsamples )
biobank.invoice.index=( amount )
biobank.invoice.delete=delete from ${biobank.invoice.table} where invoiceid = ?
biobank.invoice.insert=insert into ${biobank.invoice.table} values( ?\, ?\, ?\, ?\, ?\, ?\, ?\, ?\, ?\, ?\, ?\, ?\, ? )
biobank.invoice.update=update ${biobank.invoice.table} set purchase = ?\, invoice = ?\, started = ?\, ended = ?\, verified = ?\, approved = ?\, currency = ?\, numsamples = ?\, amount = ?\, rejected = ?\, reason = ?\, created = ? where invoiceid = ?
biobank.invoice.findById=select i.*\, p.title from ${biobank.project.table} p\, ${biobank.invoice.table} i left join ${biobank.billing.table} b on (i.purchase = b.purchase) where i.invoiceid = ? and p.projectid = b.projectid group by i.invoiceid\, p.title order by i.invoiceid\, p.title
biobank.invoice.findByIdBasic=select i.* from ${biobank.invoice.table} i where i.invoiceid = ?
biobank.invoice.findByInvoice=select i.*\, p.title from ${biobank.project.table} p\, ${biobank.invoice.table} i left join ${biobank.billing.table} b on (i.purchase = b.purchase) where i.invoice = ? and p.projectid = b.projectid group by i.invoiceid\, p.title order by i.invoiceid\, p.title
biobank.invoice.findByPeriodDesc=select i.*\, p.title from ${biobank.project.table} p\, ${biobank.invoice.table} i left join ${biobank.billing.table} b on (i.purchase = b.purchase) where i.started >= ? and i.ended <= ? and p.projectid = b.projectid group by i.invoiceid\, p.title order by i.ended desc\, i.invoiceid
biobank.invoice.findByPeriodAsc=select i.*\, p.title from ${biobank.project.table} p\, ${biobank.invoice.table} i left join ${biobank.billing.table} b on (i.purchase = b.purchase) where i.started >= ? and i.ended <= ? group by i.invoiceid\, p.title order by i.ended asc\, i.invoiceid

biobank.propertytype.table=t_property_type
biobank.propertytype.structure=( typeid bigint primary key\, typename varchar(50)\, label varchar(80) )
biobank.propertytype.index=( typename )
biobank.propertytype.insert=insert into ${biobank.propertytype.table} values( ?\, ?\, ? )
biobank.propertytype.findById=select * from ${biobank.propertytype.table} where typeid = ?
biobank.propertytype.findByName=select * from ${biobank.propertytype.table} where typename = ?

biobank.property.table=t_property
biobank.property.structure=( propertyid bigint primary key\, propertyname varchar(50)\, label varchar(80)\, typeid bigint\, unit varchar(20)\, parentid bigint\, trackid bigint )
biobank.property.index=( propertyname )
biobank.property.index=( typeid )
biobank.property.index=( trackid )
biobank.property.insert=insert into ${biobank.property.table} values( ?\, ?\, ?\, ?\, ?\, ?\, ? )
biobank.property.update=update ${biobank.property.table} set propertyname = ?\, label = ?\, typeid = ?\, unit = ?\, parentid = ?\, trackid = ? where propertyid = ?
biobank.property.delete=delete from ${biobank.property.table} where propertyid = ?
biobank.property.findByName=select p.*\,t.typename\, c.columnid\, c.dbformat\, c.informat\, c.outformat\, c.columnsize\, c.digits\, c.minoccurs\, c.maxoccurs\, c.mandatory from ${biobank.property.table} p left join ${biobank.column.table} c on (p.propertyid = c.propertyid)\, ${biobank.propertytype.table} t where p.propertyname like ? and p.typeid = t.typeid
biobank.property.findById=select p.*\,t.typename\, c.columnid\, c.dbformat\, c.informat\, c.outformat\, c.columnsize\, c.digits\, c.minoccurs\, c.maxoccurs\, c.mandatory from ${biobank.property.table} p left join ${biobank.column.table} c on (p.propertyid = c.propertyid)\, ${biobank.propertytype.table} t where p.propertyid = ? and p.typeid = t.typeid
biobank.property.findByName=select p.*\,t.typename\, c.columnid\, c.dbformat\, c.informat\, c.outformat\, c.columnsize\, c.digits\, c.minoccurs\, c.maxoccurs\, c.mandatory from ${biobank.property.table} p left join ${biobank.column.table} c on (p.propertyid = c.propertyid)\, ${biobank.propertytype.table} t where p.propertyname = ? and p.typeid = t.typeid
biobank.property.findByNameType=select p.*\,t.typename\, c.columnid\, c.dbformat\, c.informat\, c.outformat\, c.columnsize\, c.digits\, c.minoccurs\, c.maxoccurs\, c.mandatory from ${biobank.property.table} p left join ${biobank.column.table} c on (p.propertyid = c.propertyid)\, ${biobank.propertytype.table} t where p.propertyname = ? and t.typename = ? and p.typeid = t.typeid

biobank.propertyset.table=t_property_list
biobank.propertyset.structure=( listid bigint primary key\, listname varchar(80)\, typeid bigint )
biobank.propertyset.index=( listname )
biobank.propertyset.index=( typeid )
biobank.propertyset.insert=insert into ${biobank.propertyset.table} values( ?\, ?\, ? )
biobank.propertyset.delete=delete from ${biobank.propertyset.table} where listid = ?
biobank.propertyset.findByName=select l.listid\, l.listname\,t.typename as listtype\, m.propertyid\, m.display from ${biobank.propertyset.table} l left join ${biobank.member.table} m on (l.listid = m.listid)\, ${biobank.propertytype.table} t where l.typeid = t.typeid and l.listname like ? order by m.rank
biobank.propertyset.findById=select l.listid\, l.listname\,t.typename as listtype\, m.propertyid\, m.display from ${biobank.propertyset.table} l left join ${biobank.member.table} m on (l.listid = m.listid)\, ${biobank.propertytype.table} t where l.typeid = t.typeid and l.listid = ? order by m.rank

biobank.propertyvalue.table=t_property_value
biobank.propertyvalue.structure=( valueid bigint primary key\, propertyid bigint\, charvalue varchar(254)\, numvalue double\, rank int )
biobank.propertyvalue.index=( propertyid )
biobank.propertyvalue.index=( rank )
biobank.propertyvalue.index=( charvalue )
biobank.propertyvalue.index=( numvalue )
biobank.propertyvalue.insert=insert into ${biobank.propertyvalue.table} values( ?\, ?\, ?\, ?\, ? )
biobank.propertyvalue.delete=delete from ${biobank.propertyvalue.table} where propertyid = ?
biobank.propertyvalue.findById=select v.* from ${biobank.propertyvalue.table} v where v.valueid = ?
biobank.propertyvalue.findByProperty=select v.* from ${biobank.propertyvalue.table} v where v.propertyid = ?
biobank.propertyvalue.findTerms=select pv.charvalue from ${biobank.propertyvalue.table} pv\, ${biobank.property.table} prop\, ${biobank.donorproperty.table} dp where pv.propertyid = prop.propertyid and prop.propertyname = ? and prop.propertyid = dp.propertyid group by pv.charvalue 

biobank.restrict.table=t_restrict_rule
biobank.restrict.structure=( restrictid bigint primary key\, rule varchar(20)\, restriction varchar(128)\, datatype varchar(20)\, propertyid bigint )
biobank.restrict.index=( rule )
biobank.restrict.index=( restriction )
biobank.restrict.index=( propertyid )
biobank.restrict.insert=insert into ${biobank.restrict.table} values( ?\, ?\, ?\, ?\, ? )
biobank.restrict.update=update ${biobank.restrict.table} set rule = ?\, restriction = ?\, datatype = ?\, propertyid = ?\ where restrictid = ?
biobank.restrict.findById=select r.*\, p.propertyname\, t.typename\, p.label\, t.typeid\, p.unit\, p.parentid from ${biobank.restrict.table} r\, ${biobank.property.table} p\, ${biobank.propertytype.table} t where r.restrictid = ? and p.propertyid = r.propertyid and p.typeid = t.typeid
biobank.restrict.findByRule=select r.*\, p.propertyname\, t.typename\, p.label\, t.typeid\, p.unit\, p.parentid from ${biobank.restrict.table} r\, ${biobank.property.table} p\, ${biobank.propertytype.table} t where r.rule = ? and p.propertyid = r.propertyid and p.typeid = t.typeid

biobank.restrictapply.table=t_restrict_apply
biobank.restrictapply.structure=( applyid bigint primary key\, restrictid bigint\, studyid bigint\, orgid bigint\, propertyid bigint )
biobank.restrictapply.index=( restrictid )
biobank.restrictapply.index=( studyid )
biobank.restrictapply.index=( orgid )
biobank.restrictapply.index=( propertyid )
biobank.restrictapply.insert=insert into ${biobank.restrictapply.table} values( ?\, ?\, ?\, ?\, ? )
biobank.restrictapply.update=update ${biobank.restrictapply.table} set restrictid = ?\, studyid = ?\, orgid = ?\, propertyid = ? where applyid = ?
biobank.restrictapply.findRestriction=select r.*\, pv.valueid\, pv.charvalue\, pv.numvalue\, pv.rank from ${biobank.restrictapply.table} r left join ${biobank.propertyvalue.table} pv on (r.propertyid = pv.propertyid) where r.restrictid = ? and r.studyid = ? and r.orgid = ?
biobank.restrictapply.findBySample=select r.*\, pv.valueid\, pv.charvalue\, pv.numvalue\, pv.rank from ${biobank.donor.table} d\, ${biobank.subject.table} subj\, ${biobank.studysample.table} s\, ${biobank.restrictapply.table} r left join ${biobank.propertyvalue.table} pv on (r.propertyid = pv.propertyid) where r.orgid = 0 and s.studyid = r.studyid and s.sampleid = d.sampleid and s.studyid = subj.studyid and subj.donorid = d.donorid and d.sampleid = ?

biobank.sample.table=t_sample
biobank.sample.structure=( sampleid varchar(36) primary key\, samplename varchar(50)\, typeid bigint\, stamp bigint\, trackid bigint\, created timestamp )
biobank.sample.index=( samplename )
biobank.sample.index=( typeid )
biobank.sample.index=( trackid )
biobank.sample.insert=insert into ${biobank.sample.table} values( ?\, ?\, ?\, ?\, ?\, ? )
biobank.sample.findById=select * from ${biobank.sample.table} where sampleid = ?
biobank.sample.findByCreatedNewer=select s.*\,stud.studyid from ${biobank.sample.table} s\, ${biobank.studysample.table} stud where s.created >= ? and s.sampleid = stud.sampleid order by s.created desc
biobank.sample.findByCreatedOlder=select s.*\,stud.studyid from ${biobank.sample.table} s\, ${biobank.studysample.table} stud where s.created <= ? and s.sampleid = stud.sampleid order by s.created asc
biobank.sample.findByCreatedEqual=select s.*\,stud.studyid from ${biobank.sample.table} s\, ${biobank.studysample.table} stud where s.created = ? and s.sampleid = stud.sampleid
biobank.sample.findByLastCreated=select s.*\,stud.studyid from ${biobank.sample.table} s\, ${biobank.studysample.table} stud where date(s.created) >= date((select created from ${biobank.sample.table} order by created desc limit 1)) and s.sampleid = stud.sampleid order by s.created desc
biobank.sample.findByStudy=select s.*\,stud.studyid from ${biobank.sample.table} s\, ${biobank.studysample.table} stud\, ${biobank.study.table} study where study.studyname = ? and stud.studyid = study.studyid and s.sampleid = stud.sampleid
biobank.sample.findByType=select s.*\,stud.studyid from ${biobank.sample.table} s\, ${biobank.studysample.table} stud\, ${biobank.sampleType.table} stype where stype.typename = ? and stype.typeid = s.typeid and s.sampleid = stud.sampleid 
biobank.sample.findByDonorProperty=select s.*\,stud.studyid from ${biobank.sample.table} s\, ${biobank.studysample.table} stud\, ${biobank.propertyvalue.table} pv\, ${biobank.property.table} prop\, ${biobank.donorproperty.table} dp\, ${biobank.donor.table} d where pv.propertyid = prop.propertyid and prop.propertyname = ? and pv.charvalue = ? and prop.propertyid = dp.propertyid and dp.donorid = d.donorid and s.sampleid = d.sampleid and stud.sampleid = s.sampleid

biobank.sampledetail.table=t_sample_report
biobank.sampledetail.structure=( sampleid varchar(36) primary key\, created timestamp\, details text )
biobank.sampledetail.index=( created )
biobank.sampledetail.insert=insert into ${biobank.sampledetail.table} values( ?\, ?\, ? )
biobank.sampledetail.delete=delete from ${biobank.sampledetail.table} where sampleid = ?
biobank.sampledetail.findById=select * from ${biobank.sampledetail.table} where sampleid = ?

biobank.sampleType.table=t_sample_type
biobank.sampleType.structure=( typeid bigint primary key\, typename varchar(80)\, created timestamp ) 
biobank.sampleType.index=( typename )
biobank.sampleType.findByName=select * from ${biobank.sampleType.table} where typename = ?
biobank.sampleType.findLikeName=select * from ${biobank.sampleType.table} where typename like ?
biobank.sampleType.findById=select * from ${biobank.sampleType.table} where typeid = ?
biobank.sampleType.findTerms=select typename from ${biobank.sampleType.table} group by typename order by lower(typename)
biobank.sampleType.insert=insert into ${biobank.sampleType.table} values( ?\, ?\, ? )
biobank.sampleType.mapType=select st.* from ${biobank.sampleType.table} st\, t_sample_lookup sl where sl.typekey like ? and st.typename = sl.typename group by st.typeid

biobank.study.table=t_sample_study
biobank.study.structure=( studyid bigint primary key\, studyname varchar(50)\, started timestamp\, expire timestamp\, status varchar(30) )
biobank.study.index=( studyname )
biobank.study.index=( expire )
biobank.study.findByName=select * from ${biobank.study.table} where studyname = ?
biobank.study.findBySample=select s.* from ${biobank.study.table} s\, ${biobank.studysample.table} ss where s.studyid = ss.studyid and ss.sampleid = ?
biobank.study.findById=select * from ${biobank.study.table} where studyid = ?
biobank.study.findTerms=select studyname from ${biobank.study.table} group by studyname order by lower(studyname)
biobank.study.insert=insert into ${biobank.study.table} values( ?\, ?\, ?\, ?\, ? )

biobank.subject.table=t_sample_subject
biobank.subject.structure=( donorid bigint primary key\, studyid bigint\, subjectid varchar(50)\, species varchar(30)\, taxon bigint\, orgid bigint\, age int\, gender varchar(2)\, ethnicity varchar(50)\, usubjid varchar(60)\, enrolled timestamp )
biobank.subject.index=( studyid )
biobank.subject.index=( subjectid )
biobank.subject.index=( taxon )
biobank.subject.findById=select s.*\, p.propertyid from ${biobank.subject.table} s left join ${biobank.donorproperty.table} p on (s.donorid = p.donorid) where s.donorid = ?
biobank.subject.findByName=select s.*\, p.propertyid from ${biobank.subject.table} s left join ${biobank.donorproperty.table} p on (s.donorid = p.donorid) where s.studyid = ? and s.subjectid = ?
biobank.subject.findBySample=select s.*\, p.propertyid from ${biobank.subject.table} s\, ${biobank.donor.table} d left join ${biobank.donorproperty.table} p on (d.donorid = p.donorid) where d.sampleid = ? and s.studyid = ? and s.donorid = d.donorid
biobank.subject.insert=insert into ${biobank.subject.table} values( ?\, ?\, ?\, ?\, ?\, ?\, ?\, ?\, ?\, ?\, ? )
biobank.subject.update=update ${biobank.subject.table} set studyid = ?\, subjectid = ?\, species = ?\, taxon = ?\, orgid = ?\, age = ?\, gender = ?\, ethnicity = ?\, usubjid = ?\, enrolled = ? where donorid = ?

biobank.treatment.table=t_sample_treatment
biobank.treatment.structure=( treatid bigint primary key\, treatment varchar(80)\, treatdesc varchar(254) )
biobank.treatment.index=( treatment )
biobank.treatment.index=( treatdesc )
biobank.treatment.findByName=select * from ${biobank.treatment.table} where treatment = ? or treatdesc = ?
biobank.treatment.insert=insert into ${biobank.treatment.table} values( ?\, ?\, ?)

biobank.track.table=t_sample_tracker
biobank.track.structure=( trackid bigint primary key\, modified timestamp\, previd bigint\, item varchar(30)\, activity varchar(50)\, uid bigint\, remark varchar(254)\, content text )
biobank.track.index=( previd )
biobank.track.index=( item )
biobank.track.index=( uid )
biobank.track.findById=select trackid from ${biobank.track.table} where trackid = ?
biobank.track.insert=insert into ${biobank.track.table} values( ?\, ?\, ?\, ?\, ?\, ?\, ?\, ? )
biobank.track.delete=update ${biobank.track.table} set modified = ?\, activity = ?\, uid = ?\, remark = ?\ where trackid = ?

biobank.template.table=t_inventory_template
biobank.template.structure=( templateid bigint primary key\, templatename varchar(80)\, template text )
biobank.template.index=( templatename )
biobank.template.insert=insert into ${biobank.template.table} values( ?\, ?\, ? )
biobank.template.update=update ${biobank.template.table} set templatename = ?\, template = ? where templateid = ?
biobank.template.delete=delete from ${biobank.template.table} where templateid = ?
biobank.template.findByName=select t.*\, u.uploadid\, u.userid\, u.uploaded\, u.md5sum\, u.upload from ${biobank.template.table} t left join ${biobank.upload.table} u on (t.templateid = u.templateid) where lower(t.templatename) like ? order by t.templateid
biobank.template.findById=select t.*\, u.uploadid\, u.userid\, u.uploaded\, u.md5sum\, u.upload from ${biobank.template.table} t left join ${biobank.upload.table} u on (t.templateid = u.templateid) where t.templateid = ?

biobank.upload.table=t_inventory_upload
biobank.upload.structure=( uploadid bigint primary key\, templateid bigint\, uploaded timestamp\, userid bigint\, md5sum varchar(32)\, upload text )
biobank.upload.index=( templateid )
biobank.upload.index=( userid )
biobank.upload.index=( md5sum )
biobank.upload.insert=insert into ${biobank.upload.table} values( ?\, ?\, ?\, ?\, ?\, ? )
biobank.upload.deleteAll=delete from ${biobank.upload.table} where templateid = ?
biobank.upload.move=update ${biobank.upload.table} set upload = 'MOVED' where uploadid = ?
biobank.upload.findLatestLogs=select l.logstamp\, l.uploadid\, u.templateid\, u.uploaded\, u.userid\, u.md5sum\, count(l.uploadid) as nummsg from t_inventory_log l\, t_inventory_upload u where l.uploadid = u.uploadid group by l.uploadid order by l.logstamp desc limit 100;

biobank.uploadraw.table=t_inventory_raw
biobank.uploadraw.structure=( md5sum varchar(32) primary key\, upload text )
biobank.uploadraw.insert=insert into ${biobank.uploadraw.table} values( ?\, ? )
biobank.uploadraw.findArchiveLoads=select u.md5sum\, u.uploadid\, u.upload from ${biobank.upload.table} u where u.templateid = ? and u.uploaded < ? and u.md5sum not in (select r.md5sum from ${biobank.uploadraw.table} r)

biobank.user.table=t_sample_user
biobank.user.structure=( userid bigint primary key\, muid varchar(20)\, username varchar(80)\, apikey varchar(20)\, email varchar(80)\, active varchar(5)\, created timestamp )
biobank.user.index=( muid )
biobank.user.index=( username )
biobank.user.index=( apikey )
biobank.user.index=( email )
biobank.user.findByApikey=select * from ${biobank.user.table} where apikey = ?
biobank.user.findByMuid=select * from ${biobank.user.table} where muid = ?
biobank.user.findById=select * from ${biobank.user.table} where userid = ?

biobank.summary=select 'Samples' as groupname\, 'Samples' as term\, count(sampleid) as samplecount from ${biobank.sample.table}
biobank.summary.samples=select s.*\,stud.studyid from ${biobank.sample.table} s\, ${biobank.studysample.table} stud where s.sampleid = stud.sampleid order by s.created desc

biobank.summary.Molecules=select 'Molecules' as groupname\, count(p.sampleid) as samplecount\, concat(t.treatdesc\,'') as term from ${biobank.treatment.table} t\, ${biobank.process.table} p where t.treatment = 'Study drug' and p.treatid = t.treatid group by t.treatdesc;
biobank.summary.Molecules.samples=select distinct s.*\,stud.studyid from ${biobank.sample.table} s\, ${biobank.studysample.table} stud\, ${biobank.treatment.table} t\, ${biobank.process.table} p where t.treatment = 'Study drug' and p.treatid = t.treatid and s.sampleid = stud.sampleid and t.treatdesc = ? order by s.created desc

biobank.summary.Molecules.Sample_types=select 'Sample types' as groupname\, concat(st.typename\,'') as term\, count(s.sampleid) as samplecount from ${biobank.treatment.table} t\, ${biobank.process.table} p\, ${biobank.sampleType.table} st\, ${biobank.sample.table} s where t.treatment = 'Study drug' and p.treatid = t.treatid and p.sampleid = s.sampleid and st.typeid = s.typeid and t.treatdesc = ? group by st.typename
biobank.summary.Molecules.Sample_types.samples=select distinct s.*\, stud.studyid from ${biobank.treatment.table} t\, ${biobank.process.table} p\, ${biobank.sample.table} s\, ${biobank.sampleType.table} st\, ${biobank.studysample.table} stud where t.treatment = 'Study drug' and p.treatid = t.treatid and p.sampleid = s.sampleid and st.typeid = s.typeid and stud.sampleid = s.sampleid and t.treatdesc = ? and st.typename = ?

biobank.summary.Molecules.Studies=select 'Studies' as groupname\, concat(st.studyname\,'') as term\, count(s.sampleid) as samplecount from ${biobank.treatment.table} t\, ${biobank.process.table} p\, ${biobank.study.table} st\, ${biobank.studysample.table} s where t.treatment = 'Study drug' and p.treatid = t.treatid and p.sampleid = s.sampleid and st.studyid = s.studyid and t.treatdesc = ? group by st.studyname
biobank.summary.Molecules.Studies.samples=select distinct s.*\, stud.studyid from ${biobank.treatment.table} t\, ${biobank.process.table} p\, ${biobank.study.table} st\, ${biobank.studysample.table} stud\, ${biobank.sample.table} s where t.treatment = 'Study drug' and p.treatid = t.treatid and p.sampleid = stud.sampleid and st.studyid = stud.studyid and s.sampleid = stud.sampleid and t.treatdesc = ? and st.studyname = ?

biobank.summary.Molecules.Studies.Sample_types=select 'Sample types' as groupname\, concat(ty.typename\,'') as term\, count(s.sampleid) as samplecount from ${biobank.treatment.table} t\, ${biobank.process.table} p\, ${biobank.study.table} st\, ${biobank.studysample.table} sts\, ${biobank.sampleType.table} ty\, ${biobank.sample.table} s where t.treatment = 'Study drug' and p.treatid = t.treatid and p.sampleid = sts.sampleid and st.studyid = sts.studyid and s.sampleid = sts.sampleid and ty.typeid = s.typeid and t.treatdesc = ? and st.studyname = ? group by ty.typename
biobank.summary.Molecules.Studies.Sample_types.samples=select distinct s.*\, st.studyid from ${biobank.treatment.table} t\, ${biobank.process.table} p\, ${biobank.study.table} st\, ${biobank.studysample.table} sts\, ${biobank.sampleType.table} ty\, ${biobank.sample.table} s where t.treatment = 'Study drug' and p.treatid = t.treatid and p.sampleid = sts.sampleid and st.studyid = sts.studyid and s.sampleid = sts.sampleid and ty.typeid = s.typeid and t.treatdesc = ? and st.studyname = ? and ty.typename = ?

biobank.summary.Molecules.Locations=select 'Locations' as groupname\, concat(o.orgname\,' '\,date_format(ps.processed\,'%e %b %Y')) as term\, count(s.sampleid) as samplecount from ${biobank.treatment.table} t\, ${biobank.process.table} p\, ${biobank.process.table} ps\, ${biobank.organization.table} o\, ${biobank.event.table} tm\, ${biobank.sample.table} s where t.treatment = 'Study drug' and p.treatid = t.treatid and p.sampleid = s.sampleid and ps.sampleid = s.sampleid and ps.treatid = 7 and tm.timeid = ps.timeid and o.orgid = tm.orgid and t.treatdesc = ? group by concat(o.orgname\,' '\,ps.processed)

biobank.summary.Molecules.Locations.samples=select distinct s.*\, st.studyid\, ps.processed from ${biobank.treatment.table} t\, ${biobank.process.table} p\, ${biobank.process.table} ps\, ${biobank.organization.table} o\, ${biobank.event.table} tm\, ${biobank.studysample.table} st\, ${biobank.sample.table} s where t.treatment = 'Study drug' and p.treatid = t.treatid and p.sampleid = s.sampleid and st.sampleid = s.sampleid and ps.sampleid = s.sampleid and ps.treatid = 7 and tm.timeid = ps.timeid and o.orgid = tm.orgid and t.treatdesc = ? and ps.processed = ?

biobank.summary.Indications=select 'Indications' as groupname\, count(d.sampleid) as samplecount\, concat(pv.charvalue\,'') as term from ${biobank.propertyvalue.table} pv\, ${biobank.property.table} prop\, ${biobank.donorproperty.table} dp\, ${biobank.donor.table} d where pv.propertyid = prop.propertyid and prop.propertyname = 'Indication' and prop.propertyid = dp.propertyid and dp.donorid = d.donorid group by pv.charvalue;
biobank.summary.Indications.samples=select distinct s.*\,stud.studyid from ${biobank.sample.table} s\, ${biobank.studysample.table} stud\, ${biobank.donor.table} d\, ${biobank.propertyvalue.table} pv\, ${biobank.donorproperty.table} dp where pv.propertyid = dp.propertyid and dp.donorid = d.donorid and s.sampleid = d.sampleid and s.sampleid = stud.sampleid and pv.charvalue = ? order by s.created desc

biobank.summary.Indications.Sample_types=select 'Sample types' as groupname\, concat(st.typename\,'') as term\, count(s.sampleid) as samplecount from ${biobank.sampleType.table} st\, ${biobank.sample.table} s\, ${biobank.propertyvalue.table} pv\, ${biobank.property.table} prop\, ${biobank.donorproperty.table} dp\, ${biobank.donor.table} d where pv.propertyid = prop.propertyid and prop.propertyname = 'Indication' and prop.propertyid = dp.propertyid and dp.donorid = d.donorid and pv.charvalue = ? and d.sampleid = s.sampleid and st.typeid = s.typeid group by st.typename
biobank.summary.Indications.Sample_types.samples=select distinct s.*\,stud.studyid from ${biobank.sample.table} s\, ${biobank.sampleType.table} st\, ${biobank.studysample.table} stud\, ${biobank.donor.table} d\, ${biobank.propertyvalue.table} pv\, ${biobank.donorproperty.table} dp where pv.propertyid = dp.propertyid and dp.donorid = d.donorid and s.sampleid = d.sampleid and s.sampleid = stud.sampleid and pv.charvalue = ? and s.typeid = st.typeid and st.typename = ? order by s.created desc

